<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/types.js | stencila-js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Stencila for Javascript"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="stencila-js"><meta property="twitter:description" content="Stencila for Javascript"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/stencila/js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/JavascriptContext.js~JavascriptContext.html">JavascriptContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-collectArgs">collectArgs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-compileFunction">compileFunction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-compileJavascript">compileJavascript</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extractFunctionSpecFromDoc">extractFunctionSpecFromDoc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-findGlobals">findGlobals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extractDetailsFromError">extractDetailsFromError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseValue">parseValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coerceArray">coerceArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coercedArrayType">coercedArrayType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pack">pack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-type">type</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unpack">unpack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JSGLOBALS">JSGLOBALS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-childrenTypes">childrenTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-descendantTypes">descendantTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parentTypes">parentTypes</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/types.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// TODO: this should go into its own repo: `stencila/types`
import { isNil } from &apos;substance&apos;

// Parent of each type
const parentTypes = {
  &apos;any&apos;: null,
  &apos;null&apos;: &apos;any&apos;,
  &apos;boolean&apos;: &apos;any&apos;,
  &apos;number&apos;: &apos;any&apos;,
  &apos;integer&apos;: &apos;number&apos;,
  &apos;string&apos;: &apos;any&apos;,
  &apos;object&apos;: &apos;any&apos;,
  &apos;array&apos;: &apos;any&apos;,
  &apos;array[boolean]&apos;: &apos;array&apos;,
  &apos;array[number]&apos;: &apos;array&apos;,
  &apos;array[integer]&apos;: &apos;array[number]&apos;,
  &apos;array[string]&apos;: &apos;array&apos;,
  &apos;array[object]&apos;: &apos;array&apos;,
  &apos;table&apos;: &apos;any&apos;
}

// Children of each type
const childrenTypes = {}
for (let type of Object.keys(parentTypes)) {
  if (!childrenTypes[type]) childrenTypes[type] = []
  let base = parentTypes[type]
  if (!base) continue
  if (childrenTypes[base]) childrenTypes[base].push(type)
  else childrenTypes[base] = [type]
}

// Descendants (children, grandchildren etc) of each type
const descendantTypes = {}
for (let type of Object.keys(parentTypes)) {
  if (!descendantTypes[type]) descendantTypes[type] = []
  let parent = parentTypes[type]
  while (parent) {
    if (descendantTypes[parent]) descendantTypes[parent].push(type)
    else descendantTypes[parent] = [type]
    parent = parentTypes[parent]
  }
}

export { parentTypes, childrenTypes, descendantTypes }

export function coercedArrayType (arr) {
  let valType = arr.reduce(_mostSpecificType, undefined)
  if (valType === &apos;any&apos;) {
    return &apos;array&apos;
  } else {
    return `array[${valType}]`
  }
}

/**
 * Get the type code for a value
 *
 * @memberof value
 * @param {*} value - A JavaScript value
 * @return {string} - Type code for value
 */
export function type (value) {
  let type = typeof value

  if (isNil(value) === null) {
    return &apos;null&apos;
  } else if (type === &apos;boolean&apos;) {
    return &apos;boolean&apos;
  } else if (type === &apos;number&apos;) {
    let isInteger = false
    if (value.isInteger) isInteger = value.isInteger()
    else isInteger = (value % 1) === 0
    return isInteger ? &apos;integer&apos; : &apos;number&apos;
  } else if (type === &apos;string&apos;) {
    return &apos;string&apos;
  } else if (type === &apos;object&apos;) {
    if (value.constructor === Array) {
      return &apos;array&apos;
    }
    if (value.type) return value.type
    else return &apos;object&apos;
  } else {
    return &apos;unknown&apos;
  }
}

/*
  A helper to get a coerced array value from a given array of values.
*/
export function coerceArray (arr) {
  return {
    type: coercedArrayType(arr),
    data: arr.map(v =&gt; {
      if (v) {
        return v.data
      } else {
        return undefined
      }
    })
  }
}

function _mostSpecificType (type, next) {
  if (!next) return &apos;any&apos;
  let nextType = next.type
  if (!type) return nextType
  if (type === nextType) {
    return type
  }
  switch (type) {
    case &apos;number&apos;: {
      if (nextType === &apos;integer&apos;) {
        return &apos;number&apos;
      }
      break
    }
    case &apos;integer&apos;: {
      if (nextType === &apos;number&apos;) {
        return &apos;number&apos;
      }
      break
    }
    default:
      //
  }
  return &apos;any&apos;
}

export function pack (value, opts = {}) {
  if (isNil(value)) {
    return { type: &apos;null&apos;, data: null }
  }
  if (typeof value === &apos;function&apos;) {
    let data = { name: value.name }
    if (opts.context) data.context = opts.context.id
    if (opts.cell) data.id = opts.cell.id
    return {
      type: &apos;function&apos;,
      data
    }
  }
  if (value.type === &apos;image&apos;) {
    return { type: &apos;image&apos;, src: value.src }
  } else {
    let _type = value.type || type(value)
    return { type: _type, data: value }
  }
}

export function unpack (pkg) {
  if (isNil(pkg)) return undefined
  return pkg.data
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
